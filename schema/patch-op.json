{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "description": "Patch Operations made (manifest, config, index, etc)",
    "id": "https://opencontainers.org/schema/patch/operation",
    "type": "object",
    "properties": {
        "op": {
            "description": "Patch operation type",
            "type": "string",
            "enum": [
                "add",
                "remove",
                "replace",
                "move",
                "annotate"
            ]
        },
        "target": {
            "description": "RFC6901 JSON Pointer path to patch location",
            "type": "string"
        },
        "targetType": {
            "description": "OCI structure type being patched (manifest, config, index, etc)",
            "type": "string",
            "enum": [
                "manifest",
                "config",
                "index"
            ]
        },
        "digest": {
            "description": "Blob digest for content being placed (for add/replace)",
            "type": "string",
            "pattern": "^[a-z0-9]+(?:[+._-][a-z0-9]+)*:[a-zA-Z0-9=_-]+$"
        },
        "oldDigest": {
            "description": "Digest being replaced/removed for audit and safety (mandatory for remove/replace)",
            "type": "string",
            "pattern": "^[a-z0-9]+(?:[+._-][a-z0-9]+)*:[a-zA-Z0-9=_-]+$"
        },
        "value": {
            "description": "For patching config field values (e.g. replace config.Env)",
            "type": [
                "string",
                "number",
                "boolean",
                "array",
                "object",
                "null"
            ]
        },
        "oldValue": {
            "description": "Previous value for config field patch (for audit/rollback)",
            "type": [
                "string",
                "number",
                "boolean",
                "array",
                "object",
                "null"
            ]
        },
        "reason": {
            "description": "Why this operation is needed (CVE, etc)",
            "type": "string"
        },
        "metadata": {
            "description": "Arbitrary operation-level metadata",
            "type": "object",
            "additionalProperties": {
                "type": "string"
            }
        }
    },
    "required": [
        "op",
        "target",
        "targetType"
    ]
}